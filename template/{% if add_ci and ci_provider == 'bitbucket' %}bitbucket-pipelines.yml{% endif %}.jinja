image: python:{{ python_version }}

options:
  max-time: 20

pipelines:
  default:
    - parallel:
        - step:
            name: Test
            script:
              - pip install uv
              - uv sync --frozen
              - uv run pytest --junitxml=test-results/report.xml
        - step:
            name: Lint
            script:
              - pip install uv
              - uv sync --frozen
              - uv run ruff check src tests
        {% if add_type_checking -%}
        - step:
            name: Type Check
            script:
              - pip install uv
              - uv sync --frozen
              - uv run {{ "mypy" if type_checker == "mypy" else "ty check" }}
        {% endif -%}
