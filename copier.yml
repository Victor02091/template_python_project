_jinja_extensions:
  - copier_template_extensions.TemplateExtensionLoader
  - extensions/context.py:GitInfoExtension

# 1. Questions
project_name:
  type: str
  help: Human-readable name (e.g., "My Data Processor")
  default: "{{ current_folder_name | replace('_', ' ') | replace('-', ' ') | title }}"

project_slug:
  type: str
  help: Python package import name (e.g., "my_data_processor")
  default: "{{ project_name|lower|replace('-', '_')|replace(' ', '_') }}"

author_name:
  type: str
  help: Author Name
  default: "{{ git_user_name | default('Your Name', true) }}"

author_email:
  type: str
  help: Author Email
  default: "{{ git_user_email | default('your@email.com', true) }}"

description:
  type: str
  help: Short description of your project
  default: "A new Python project."

python_version:
  type: str
  help: Python version of this project
  default: "3.12"
  choices:
    - "3.13"
    - "3.12"
    - "3.11"
    - "3.10"
    - "3.9"

add_docker:
  type: bool
  default: true
  help: "Add Dockerfile? (Recommanded)"

add_type_checking:
  type: bool
  default: true
  help: "Add static type checking configuration? (Recommanded)"

type_checker:
  type: str
  default: mypy
  choices:
      Mypy (Standard): mypy
      Astral Ty (Modern, Beta): ty
  help: "Which type checker do you want to use?"
  when: "{{ add_type_checking }}"

add_pre_commit:
  type: bool
  default: true
  help: "Add pre-commit configuration? (Recommanded)"

add_ci:
    type: bool
    default: true
    help: "Configure CI/CD pipeline for Linting and Tests? (Recommanded)"

ci_provider:
    type: str
    default: gitlab
    choices:
      Github Actions: github
      GitLab CI: gitlab
      Bitbucket Pipelines: bitbucket
    help: "Which CI provider are you using?"
    when: "{{ add_ci }}"

add_docs:
  type: bool
  default: true
  help: "Initialize MkDocs documentation setup? (Recommanded)"

install_dependencies:
  type: bool
  help: "Install dependencies for you ?"
  default: true

install_pre_commit_hooks:
  type: bool
  help: "Install pre-commit hooks automatically?"
  default: false
  when: "{{ install_dependencies and add_pre_commit }}"

# 2. Hooks
_tasks:

  # Install dependencies
  - command: "uv sync"
    when: "{{ install_dependencies }}"

  # Initial commit
  - command: |
      # 1. Ensure a git repo exists (if not, create one)
      if [ ! -d .git ]; then
          echo "âœ¨ Initializing new Git repository..."
          git init
      fi

      # 2. Check if this is the first time the template is applied
      # We do this by checking if the answers file is already tracked by git.
      # If 'git ls-files' fails to find it in the index, it's a fresh install.
      if ! git ls-files .copier-answers.yml --error-unmatch > /dev/null 2>&1; then
          echo "ðŸš€ First template application detected. Committing..."
          git add .
          git commit -m "chore: initial commit from template"
      else
          echo "ðŸ”„ Template update detected. Skipping git commit."
      fi

  # Install pre-commit hooks
  - command: "uv run pre-commit install"
    when: "{{ install_pre_commit_hooks | default(false) }}"

# 3. Configuration
_subdirectory: template
